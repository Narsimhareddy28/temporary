{% extends "base.html" %}
<style>
  
</style>
{% block content %}
<div class="challenges-bg" style="min-height: 100vh;">
<div class="" style="text-align: center;">
  <div class="container">
    <h1>
      {% trans %}Challenges{% endtrans %}
    </h1>
  </div>
</div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      {% include "components/errors.html" %}
    </div>
  </div>

  <div x-data="ChallengeBoard" @load-challenges.window="loadChallenges()"
    @load-challenge.window="loadChallenge($event.detail)">
    <div x-ref="challengeWindow" id="challenge-window" class="modal fade" tabindex="-1" role="dialog" x-data=""
      x-html="$store.challenge.data.view"></div>

    <div x-show="!loaded">
      <div class="min-vh-50 d-flex align-items-center">
        <div class="text-center w-100">
          <i class="fas fa-circle-notch fa-spin fa-3x fa-fw spinner"></i>
        </div>
      </div>
    </div>

    <div x-show="loaded">
      <template x-for="(category, idx) in getCategories()" :key="idx">
        <div class="pt-5">
          <div class="category-header mb-3">
            <h3 x-text="category"></h3>
          </div>
          <div class="category-challenges d-flex flex-column">
            <div class="challenges-row row">
              <template x-for="(c, idx) in getChallenges(category)" :key="c.id">
                <div class="col-sm-6 col-md-4 col-lg-3 my-3">
                 <button
  class="challenge-button btn btn-dark w-100 h-100 text-white border-0 position-relative overflow-hidden"
  :class="[
    ...c.tags.map((tag) => `tag-${tag.value.replace(/ /g, '-')}`),
  ]"
  :value="c.id"
  @click="loadChallenge(c.id)"
  x-data="{
    getCategoryImage(cat) {
      if (!cat) return null;
      const name = cat.toLowerCase();
      const keywordMap = {
        web: 'web.png',
        crypto: 'crypto.png',
        forensics: 'forensics.png',
        reversing: 'reversing.png',
        misc: 'misc.png',
        osint: 'osint.png',
        pwn: 'pwn.png'
      };
      for (const keyword in keywordMap) {
        if (name.includes(keyword)) {
          return '/themes/core-beta/static/img/' + keywordMap[keyword];
        }
      }
      return null;
    }
  }"
  :style="getCategoryImage(c.category)
    ? `background: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url('${getCategoryImage(c.category)}'); background-position: center; background-size: cover; background-repeat: no-repeat; border-radius: 10px;`
    : 'background-color: #1b1b1b; border-radius: 10px;'"
  style="height: 200px; border-radius: 10px;"
>
  <!-- ✅ Solved overlay badge (conditionally shown) -->
  <template x-if="c.solved_by_me">
    <div class="position-absolute top-0 end-0 bg-success text-white px-2 py-1 small rounded-start" style="z-index: 2;">
      ✓ Solved
    </div>
  </template>

  <!-- Content layer -->
  <div class="challenge-inner my-3"  style="z-index: 1;">
    <p class="fw-bold mb-1" x-text="c.name"></p>
    <span x-text="c.value"></span>
  </div>
</button>
                </div>
              </template>
            </div>
          </div>
        </div>
      </template>
    </div>
  </div>
</div>

</div>
{% endblock %}

{% block scripts %}
{{ Assets.js("assets/js/challenges.js") }}
{% endblock %}